local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local uis = game:GetService("UserInputService")

-- Fly variables
local flying = true
local speed = 50
local velocity = Vector3.new(0,0,0)

-- Create BodyVelocity to control movement
local bodyVelocity = Instance.new("BodyVelocity")
bodyVelocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
bodyVelocity.Velocity = Vector3.new(0,0,0)
bodyVelocity.Parent = humanoidRootPart

-- Movement controls
uis.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.Space then
        velocity = velocity + Vector3.new(0,1,0)
    elseif input.KeyCode == Enum.KeyCode.LeftShift then
        velocity = velocity + Vector3.new(0,-1,0)
    end
end)

uis.InputEnded:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.Space or input.KeyCode == Enum.KeyCode.LeftShift then
        velocity = Vector3.new(0,0,0)
    end
end)

-- Update fly movement every frame
game:GetService("RunService").RenderStepped:Connect(function()
    if flying then
        local cam = workspace.CurrentCamera
        local moveDirection = Vector3.new(0,0,0)
        local keys = uis:GetKeysPressed()
        for _,key in ipairs(keys) do
            if key.KeyCode == Enum.KeyCode.W then moveDirection = moveDirection + cam.CFrame.LookVector end
            if key.KeyCode == Enum.KeyCode.S then moveDirection = moveDirection - cam.CFrame.LookVector end
            if key.KeyCode == Enum.KeyCode.A then moveDirection = moveDirection - cam.CFrame.RightVector end
            if key.KeyCode == Enum.KeyCode.D then moveDirection = moveDirection + cam.CFrame.RightVector end
        end
        bodyVelocity.Velocity = (moveDirection + velocity).Unit * speed
    else
        bodyVelocity.Velocity = Vector3.new(0,0,0)
    end
end)

print("Fly script activated! Use WASD + Space/Shift to move.")
